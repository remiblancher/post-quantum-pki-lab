================================================================================
                    APP-03: "Show Me Your Badge"
                 Mutual TLS Authentication Diagrams
================================================================================

1. TRADITIONAL TLS vs MUTUAL TLS
────────────────────────────────────────────────────────────────────────────────

    TRADITIONAL TLS (One-way)              MUTUAL TLS (Two-way)
    ─────────────────────────              ────────────────────────

    ┌────────┐         ┌────────┐          ┌────────┐         ┌────────┐
    │ Client │         │ Server │          │ Client │         │ Server │
    └───┬────┘         └───┬────┘          └───┬────┘         └───┬────┘
        │                  │                   │                  │
        │                  │                   │                  │
        │  Who are you?    │                   │  Who are you?    │
        │ ────────────────>│                   │ ────────────────>│
        │                  │                   │                  │
        │  I'm server.com  │                   │  I'm server.com  │
        │  [Certificate]   │                   │  [Certificate]   │
        │ <────────────────│                   │ <────────────────│
        │                  │                   │                  │
        │  ✓ Verified      │                   │  Show YOUR badge!│
        │                  │                   │ <────────────────│
        │                  │                   │                  │
        │  (no client ID)  │                   │  I'm Alice       │
        │                  │                   │  [Certificate]   │
        │                  │                   │ ────────────────>│
        │                  │                   │                  │
        │                  │                   │  ✓ Both verified │
        │                  │                   │                  │
        ▼                  ▼                   ▼                  ▼

    Server knows: IP address           Server knows: Alice's identity
    Client knows: Server's identity    Client knows: Server's identity


2. mTLS HANDSHAKE FLOW (TLS 1.3)
────────────────────────────────────────────────────────────────────────────────

    ┌──────────────┐                                    ┌──────────────┐
    │   Client     │                                    │   Server     │
    │   (Alice)    │                                    │   (API)      │
    └──────┬───────┘                                    └──────┬───────┘
           │                                                   │
           │ ─────────────── ClientHello ─────────────────────>│
           │   • Supported cipher suites                       │
           │   • Key share (for ECDHE)                         │
           │                                                   │
           │ <────────────── ServerHello ──────────────────────│
           │   • Selected cipher suite                         │
           │   • Key share                                     │
           │                                                   │
           │ <──────────── EncryptedExtensions ────────────────│
           │                                                   │
           │ <──────────── CertificateRequest ─────────────────│
           │   "Send me YOUR certificate!"                     │
           │                                                   │
           │ <──────────── Certificate (Server) ───────────────│
           │   • Server's ML-DSA certificate                   │
           │   • CA chain                                      │
           │                                                   │
           │ <──────────── CertificateVerify ──────────────────│
           │   • Signature proving server owns the key         │
           │                                                   │
           │ <──────────── Finished ───────────────────────────│
           │                                                   │
           │ ────────────── Certificate (Client) ─────────────>│
           │   • Alice's ML-DSA certificate                    │
           │   • Signed by the same CA                         │
           │                                                   │
           │ ────────────── CertificateVerify ────────────────>│
           │   • Signature proving Alice owns the key          │
           │                                                   │
           │ ────────────── Finished ─────────────────────────>│
           │                                                   │
           │                                                   │
           │ ═══════════════ Application Data ════════════════>│
           │      GET /api/whoami                              │
           │                                                   │
           │ <═══════════════ Response ════════════════════════│
           │      "Welcome Alice!"                             │
           │                                                   │


3. CERTIFICATE CHAIN
────────────────────────────────────────────────────────────────────────────────

                        ┌─────────────────────────┐
                        │      ML-DSA CA          │
                        │   "mTLS Demo CA"        │
                        │                         │
                        │  Signs server & client  │
                        │  certificates           │
                        └───────────┬─────────────┘
                                    │
                    ┌───────────────┼───────────────┐
                    │               │               │
                    ▼               ▼               ▼
        ┌───────────────┐  ┌───────────────┐  ┌───────────────┐
        │    Server     │  │    Alice      │  │     Bob       │
        │  "localhost"  │  │  (Employee)   │  │   (Admin)     │
        │               │  │               │  │               │
        │  profile:     │  │  profile:     │  │  profile:     │
        │  tls-server   │  │  tls-client   │  │  tls-client   │
        └───────────────┘  └───────────────┘  └───────────────┘


4. ACCESS CONTROL SCENARIOS
────────────────────────────────────────────────────────────────────────────────

    ┌─────────────────────────────────────────────────────────────────────────┐
    │                           mTLS SERVER                                   │
    │                     https://localhost:8443                              │
    │                                                                         │
    │   Requires: Valid client certificate signed by trusted CA              │
    │                                                                         │
    └─────────────────────────────────────────────────────────────────────────┘
                                     │
           ┌─────────────────────────┼─────────────────────────┐
           │                         │                         │
           ▼                         ▼                         ▼

    ┌─────────────┐           ┌─────────────┐           ┌─────────────┐
    │    ALICE    │           │     BOB     │           │   MALLORY   │
    │             │           │             │           │             │
    │ Has valid   │           │ Has valid   │           │ No cert or  │
    │ client cert │           │ client cert │           │ invalid CA  │
    └──────┬──────┘           └──────┬──────┘           └──────┬──────┘
           │                         │                         │
           ▼                         ▼                         ▼

    ┌─────────────┐           ┌─────────────┐           ┌─────────────┐
    │             │           │             │           │             │
    │  ✓ Welcome  │           │  ✓ Welcome  │           │  ✗ 403      │
    │    Alice!   │           │    Bob!     │           │  Forbidden  │
    │             │           │             │           │             │
    └─────────────┘           └─────────────┘           └─────────────┘


5. WHY PQC FOR mTLS?
────────────────────────────────────────────────────────────────────────────────

    TODAY (Classical mTLS)              FUTURE (Quantum Attack)
    ──────────────────────              ───────────────────────

    ┌─────────┐                         ┌─────────┐
    │ Attacker│                         │ Quantum │
    │         │                         │ Attacker│
    └────┬────┘                         └────┬────┘
         │                                   │
         │  Records TLS                      │  Breaks ECDSA
         │  handshake                        │  signatures
         │                                   │
         ▼                                   ▼

    ┌─────────────────┐                 ┌─────────────────┐
    │ Encrypted data  │                 │ Forged client   │
    │ stored for      │  ───────────>   │ certificate!    │
    │ later           │                 │                 │
    └─────────────────┘                 └─────────────────┘
                                               │
                                               ▼
                                        ┌─────────────────┐
                                        │ Impersonate     │
                                        │ Alice or Bob    │
                                        │ to the server   │
                                        └─────────────────┘


    WITH ML-DSA (Post-Quantum mTLS)
    ───────────────────────────────

    ┌─────────────┐
    │   Quantum   │
    │   Computer  │
    └──────┬──────┘
           │
           │  Can't forge ML-DSA
           │  signatures
           │
           ▼

    ┌─────────────────┐
    │      ✗ ✗ ✗      │
    │   BLOCKED!      │
    │                 │
    │  Lattice-based  │
    │  cryptography   │
    │  resists        │
    │  quantum        │
    │  attacks        │
    │                 │
    └─────────────────┘


6. ZERO-TRUST ARCHITECTURE
────────────────────────────────────────────────────────────────────────────────

                            ┌─────────────────────┐
                            │   TRUST NOTHING     │
                            │   VERIFY EVERYTHING │
                            └──────────┬──────────┘
                                       │
           ┌───────────────────────────┼───────────────────────────┐
           │                           │                           │
           ▼                           ▼                           ▼

    ┌─────────────────┐       ┌─────────────────┐       ┌─────────────────┐
    │  IDENTITY       │       │  DEVICE         │       │  CONTEXT        │
    │                 │       │                 │       │                 │
    │  WHO are you?   │       │  WHAT device?   │       │  WHERE/WHEN?    │
    │                 │       │                 │       │                 │
    │  ─────────────  │       │  ─────────────  │       │  ─────────────  │
    │                 │       │                 │       │                 │
    │  mTLS client    │       │  Device cert    │       │  IP, time,      │
    │  certificate    │       │  (in client     │       │  behavior       │
    │  proves user    │       │   cert SAN)     │       │  analysis       │
    │  identity       │       │                 │       │                 │
    └─────────────────┘       └─────────────────┘       └─────────────────┘
           │                           │                           │
           └───────────────────────────┼───────────────────────────┘
                                       │
                                       ▼
                            ┌─────────────────────┐
                            │   ACCESS DECISION   │
                            │                     │
                            │   ✓ Allow / ✗ Deny  │
                            └─────────────────────┘


================================================================================
                              END OF DIAGRAMS
================================================================================
